---
import { getCollection } from "astro:content";
import "../../styles/components/menus/side-bar.scss";
import DropdownIcon from "../icons/DropdownIcon.astro";

const posts = await getCollection("post");
const categories = [...new Set(posts.map((post) => post.data.category))];
---

<nav class="sidebar__menu">
  <ul class="menu__box">
    <li class="menu__sub">
      <button
        class="menu__sub__button"
        aria-expanded="false"
        aria-controls="category-submenu"
      >
        <span>카테고리</span>
        <div class="menu__sub__icon">
          <DropdownIcon
            size="24px"
            color="light-dark(rgba(63,92,255, 0.9),rgba(255,255,255,0.9))"
          />
        </div>
      </button>
      <ul id="category-submenu" class="menu__sub__list menu-active">
        {
          categories.map((category) => (
            <li class="menu__sub__item">
              <a href={`/category/${category}`} class="menu__sub__link">
                {category}
              </a>
            </li>
          ))
        }
      </ul>
    </li>
  </ul>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const menuButtons = document.querySelectorAll(".menu__sub__button");

    menuButtons.forEach((button) => {
      button.addEventListener("click", function () {
        const submenu = this.nextElementSibling;
        const isExpanded = this.getAttribute("aria-expanded") === "true";

        this.setAttribute("aria-expanded", !isExpanded);
        submenu.classList.toggle("menu-active");
        const iconDiv = this.querySelector(".menu__sub__icon");
        if (iconDiv) {
          iconDiv.classList.toggle("rotate-icon", !isExpanded);
        }
      });
    });
  });
</script>
